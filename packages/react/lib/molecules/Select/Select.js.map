{"version":3,"file":"Select.js","sources":["../../../src/molecules/Select/Select.tsx"],"sourcesContent":["import React, { createRef, KeyboardEventHandler, useEffect, useRef, useState } from \"react\";\nimport Text from \"../../atoms/Text\";\n\nconst KEY_CODES = {\n    ENTER:13,\n    SPACE: 32,\n    DOWN_ARROW: 40,\n    ESC: 27,\n    UP_ARROW: 38\n}\n\ninterface SelectOption {\n    label: string,\n    value: string\n}\n\ninterface RenderOptionProps {\n   isSelected: boolean,\n   option: SelectOption,\n   getOptionRecommendedProps: (overrideProps?: object) => object\n}\n\ninterface SelectProps {\n  oneOptionSelected?: (option: SelectOption, optionIndex: number) => void,\n  options?: SelectOption[]\n  label?: string,\n  renderOption?: (props: RenderOptionProps) => React.ReactNode\n}\n\nconst getPreviousOptionIndex = (currentIndex:number|null, option:Array<SelectOption>) => {\n    if (currentIndex === null) {\n       return 0\n    }\n    if (currentIndex === option.length - 1) {\n        return 0\n    }\n    return currentIndex + 1\n}\n\nconst getNextOptionIndex = (currentIndex:number|null, option:Array<SelectOption>) => {\n    if (currentIndex === null) {\n       return 0\n    }\n    if (currentIndex === option.length - 1) {\n        return 0\n    }\n    return currentIndex + 1\n}\n\nconst Select: React.FunctionComponent<SelectProps> = ({options=[], label=\"Please select an option..\", oneOptionSelected:handler, renderOption}) => {\n    const [isOpen, setIsOpen] = useState<boolean>(false);\n    const labelRef = useRef<HTMLButtonElement>(null)\n    const [overlayTop, setOverlayTop] = useState<number>(0)\n    const [selectedIndex, setSelectedIndex] = useState<null|number>(null)\n    const [highLightedIndex, setHighLightedIndex] = useState<null|number>(null)\n    const [optionRefs, setOptionRefs] = useState<React.RefObject<HTMLLIElement>[]>([])\n\n    const oneOptionSelected = (option:SelectOption, optionIndex:number) => {\n        if (handler) {\n            handler(option, optionIndex)\n        }\n        setSelectedIndex(optionIndex)\n        setIsOpen(false)\n    }\n    const onLabelClick = () => {\n        setIsOpen(!isOpen)\n    }\n\n    useEffect(() => {\n       setOverlayTop((labelRef.current?.offsetHeight || 0)+10)\n    },[labelRef.current?.offsetHeight])\n\n    let selectedOption = null;\n\n    if (selectedIndex !== null) {\n       selectedOption = options[selectedIndex]\n    }\n\n    const highlightItem = (optionIndex: number|null) => {\n        setHighLightedIndex(optionIndex)\n        if (optionIndex !== null) {\n           const ref = optionRefs[optionIndex]\n\n           if (ref && ref.current) {\n              ref.current.focus()\n           }\n        }\n    }\n\n    const onButtonKeyDown:KeyboardEventHandler = (event) => {\n       event.preventDefault();\n       console.log(\"event\", event)\n       if ([KEY_CODES.ENTER, KEY_CODES.SPACE, KEY_CODES.DOWN_ARROW].includes(event.keyCode)) {\n            setIsOpen(true);\n            highlightItem(0)\n       }\n    }\n\n    useEffect(()=> {\n      setOptionRefs(options.map(_ => createRef<HTMLLIElement>()))\n    },[options.length])\n\n    useEffect(()=> {\n        if (highLightedIndex !== null && isOpen) {\n            const ref = optionRefs[highLightedIndex];\n            if (ref && ref.current) {\n                ref.current.focus()\n            }\n        }\n      },[isOpen, highLightedIndex])\n\n      const onOptionKeyDown:KeyboardEventHandler = (event) => {\n          if (event.keyCode === KEY_CODES.ESC) {\n            setIsOpen(false)\n            return\n          }\n          if (event.keyCode === KEY_CODES.DOWN_ARROW) {\n            highlightItem(getNextOptionIndex(highLightedIndex, options))\n          }\n          if (event.keyCode === KEY_CODES.UP_ARROW) {\n            highlightItem(getPreviousOptionIndex(highLightedIndex, options))\n          }\n          if (event.keyCode === KEY_CODES.ENTER) {\n            oneOptionSelected(options[highLightedIndex!], highLightedIndex!)\n          }\n      }\n\n    return <div className=\"dse-select\">\n        <button data-testid=\"DseSelectBtn\" onKeyDown={onButtonKeyDown} aria-controls=\"dse-select-list\" aria-haspopup={true} aria-expanded = {isOpen ? true : undefined} ref={labelRef} className=\"dse-select__label\" onClick={() => onLabelClick()}>\n            <Text>{selectedOption === null ? label : selectedOption.label}</Text>\n            <svg className={`dse-select__caret ${isOpen ? 'dse-select__caret--open':'dse-select__caret--close'}`} xmlns=\"http://www.w3.org/2000/svg\" width='1rem' height='1rem' fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}>\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M19 9l-7 7-7-7\" />\n            </svg>\n        </button>\n        {isOpen ? <ul role='menu' id = \"dse-select-list\" className=\"dse-select__overlay\" style={{top:overlayTop}}>\n           {options.map((option, optionIndex) => {\n            const isSelected = selectedIndex === optionIndex;\n            const isHighLighted = highLightedIndex === optionIndex;\n            const ref = optionRefs[optionIndex];\n            const RenderOptionProps = {\n                ref,\n                option,\n                isSelected,\n                getOptionRecommendedProps: (overrideProps = {}) => {return {\n                    ref,\n                    role:'menuitemradio',\n                    'aria-label': option.label,\n                    'aria-checked': isSelected ? true : undefined,\n                    onKeyDown: onOptionKeyDown,\n                    tabIndex: isHighLighted ? -1 : 0,\n                    onMouseEnter: () => highlightItem(optionIndex),\n                    onMouseLeave: () => highlightItem(null),\n                    className: `dse-select__option ${isSelected ? 'dse-select__option--selected':''} ${isHighLighted ? 'dse-select__option--highlighted' : ''}`,\n                    onClick: () => oneOptionSelected(option, optionIndex),\n                    key: option.value,\n                    ...overrideProps\n                }}\n            }\n            if (renderOption) {\n                return renderOption(RenderOptionProps)\n            }\n            return  <li  {...RenderOptionProps.getOptionRecommendedProps()}>\n                 <Text>{option.label}</Text>\n                 {isSelected ? <svg xmlns=\"http://www.w3.org/2000/svg\" width='1rem' height='1rem' viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                    <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n                </svg>:null}\n                </li>\n           })}\n        </ul> : null}\n        \n    </div>\n} \n\nexport default Select;"],"names":[],"mappings":"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"}